import{E as P}from"./exportToExcel-DeJInSqA.js";function L(g={},E=[]){var r;if(Object.keys(g).length===0){console.warn("Sheet data is empty!");return}let v="<tr>",f="",y=`<div class="w-full overflow-scroll max-h-[450px] my-4 rounded-md border border-black">
        <table class="min-w-full divide-y divide-black font-siemreap">
        <thead class="bg-gray-600 text-white text-xs uppercase tracking-wider">`;const w=Object.entries(g),j=((r=w[0])==null?void 0:r[1])||{};let b=Object.keys(j);const T=["home_no","street_no","village","commune_sangkat","district_khan","provience_city"];b=b.filter(n=>!T.includes(n)),E.forEach(n=>{v+=`<th class="px-6 py-3 text-left whitespace-nowrap">${n}</th>`}),v+="</tr>",y+=v+'</thead><tbody class="bg-white divide-y divide-gray-200">';function e(n){if(!n)return"-";let t=new Date(n);return isNaN(t.getTime())?n:t.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})}w.slice(1).forEach(([n,t])=>{f+="<tr>",b.forEach(o=>{let a=t[o]||"-";o==="registration_date"&&(a=e(a)),f+=`<td class="px-6 py-4 text-sm text-gray-500 whitespace-nowrap">${a}</td>`}),f+="</tr>"}),y+=f+"</tbody></table></div>",$("#sheetTable").html(y)}var u={},d="",V={"នាម គោត្តនាម":"name_kh",ឈ្មោះឡាតាំង:"name_en",ភេទ:"gender",ថ្ងៃខែឆ្នាំកំណើត:"date_of_birth",ទីកន្លែងកំណើត:"pob_provience_city",គ្រឹះស្ថានសិក្សា:"institute_id",តួនាទី:"type",កម្រិតសិក្សា:"education_level",ទទួលបានវគ្គបណ្ដុះបណ្ដាល:"training_received",ពិការភាព:"member_status",ឆ្នាំសិក្សា:"acadmedic_year",ថ្ងៃខែឆ្នាំចូលជាសមាជិក:"registration_date",អាសយដ្ឋានបច្ចុប្បន្ន:"full_current_address","ទូរស័ព្ទផ្ទាល់ខ្លួន/តេលេក្រាម":"phone_number",ទូរស័ព្ទអាណាព្យាបាល:"guardian_phone",ទំហំអាវ:"shirt_size",ផ្ទះលេខ:"home_no",ផ្លូវលេខ:"street_no",ភូមិ:"village","ឃុំ/សង្កាត់":"commune_sangkat","ស្រុក/ខណ្ឌ":"district_khan",ខេត្តរាជធានី:"provience_city"};$(document).ready(function(){var g="";b(),$.ajax({type:"GET",url:"/getBranchByUser",data:{},success:function(e){$("#branch_name").val(e[0].branch_kh)},failure:function(e){alert(e.responseText)},error:function(e){alert(e.responseText)}}),$("#district-select").on("change",function(){var e=$("#district-select").val();$("#import-section").addClass("hidden"),T(e)}),$("#school-select").on("change",function(){var e=$("#school-select").val();g=e,console.log(e),$("#import-section").removeClass("hidden")}),$("#sheetBtn").on("click",function(e){e.preventDefault(),$("#menu").addClass("hidden")}),$("#dropzone-file").on("change",async function(){var e=[];u={},d="";const r=$("#dropzone-file")[0];if(r.files.length>0){const n=r.files[0],t=new FileReader;t.onload=async function(o){try{const l=new P.Workbook,k=o.target.result;await l.xlsx.load(k),l.eachSheet((s,C)=>{console.log(`Sheet Name: ${s.name}, ${C}`);const B=s.getSheetValues();console.log("All sheet data:",B);const O=s.rowCount;let h=null,S=null,I={};if(s.eachRow((m,D)=>{const _=m.values.slice(1);_.includes("ល.រ")&&(e=_.slice(1),h=D),_.some(i=>i&&i.toString().includes("សរុបចំនួន"))&&(S=D)}),h&&S)for(let m=h;m<S;m++){let _=s.getRow(m).values.slice(2).map(c=>c&&typeof c=="object"&&c.result!==void 0?c.result:c??null),i={};e.forEach((c,A)=>{let x=_[A]||null;if(c==="ថ្ងៃខែឆ្នាំកំណើត"&&w(x)&&(x=f(x)),c==="អាសយដ្ឋានបច្ចុប្បន្ន"){const N=(x||"").split(" ").filter(R=>R.trim()!==""),p=j(N);i.home_no=p[0]||null,i.street_no=p[1]||null,i.village=p[2]||null,i.commune_sangkat=p[3]||null,i.district_khan=p[4]||null,i.provience_city=p[5]||null}i[V[c]]=x}),I[m]=i}u[s.name]=I});var a="";for(let s=0;s<Object.keys(u).length;s++)a+=v(Object.keys(u)[s]);$("#menu").removeClass("hidden"),$("#sheetContainer").html(a),$("div#sheetContainer").on("click","button",function(s){s.preventDefault(),$("div#sheetContainer").find("button").not(this).removeClass("bg-gray-800").addClass("bg-gray-300"),$(this).removeClass("bg-gray-800").addClass("bg-black").addClass("isactive"),$(this).attr("disabled",!0),d=$(this).text().trim(),L(u[d],e),console.log("sheetobj=>",u[d])})}catch(l){console.error("Error reading Excel file:",l)}},t.readAsArrayBuffer(n)}}),$("#sheetImport").on("click",function(){if(!d||!u[d]){alert("No active sheet selected!");return}let e=Object.values(u[d]);e=e.map(r=>({...r,school_id:g})),console.log("memberData=>",e),E(e.slice(1))}),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});function E(e){$.ajax({url:"/importmember",method:"POST",contentType:"application/json",data:JSON.stringify({members:e}),success:function(r){console.log("Success:",r)},error:function(r){console.error("Error:",r.responseText)}})}function v(e=""){var r=`<button
                class="dark:text-gray-800 dark:hover:bg-gray-100 dark:bg-white sm:w-auto mt-4 text-base  text-center text-white py-6 px-6 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-800 bg-gray-800 hover:bg-black rounded-md">${e}
            </button>`;return r}function f(e=""){try{if(!e||typeof e!="string")throw new Error("Invalid input: The input string must be a non-empty string.");const r=e.split(" "),[n,t,o]=r,a={មករា:"01",កុម្ភៈ:"02",មីនា:"03",មេសា:"04",ឧសភា:"05",មិថុនា:"06",កក្កដា:"07",សីហា:"08",កញ្ញា:"09",តុលា:"10",វិច្ឆិកា:"11",ធ្នូ:"12"},l={6112:"0",6113:"1",6114:"2",6115:"3",6116:"4",6117:"5",6118:"6",6119:"7",6120:"8",6121:"9"},k=O=>[...O].map(h=>l[h.codePointAt(0).toString()]||h).join(""),s=k(n),C=k(o);if(!a[t])throw new Error(`Invalid month: "${t}" is not a recognized Khmer month.`);return`${C}-${a[t]}-${s}`}catch(r){return console.error(`Error: ${r.message}`),null}}const y=/[\u17E0-\u17E9]/;function w(e){return y.test(e)}function j(e){const r=Array(6).fill(""),n=e.map(o=>o.trim()).filter(o=>o!=="");let t=5;for(let o=n.length-1;o>=0&&t>=0;o--)r[t]=n[o],t--;return r}$("#importBtn").on("click",function(){});function b(){return new Promise((e,r)=>{$.ajax({type:"GET",url:"/getDistrictByUserLogin",data:{},success:function(n){console.log(n);var t=$("#district-select");t.empty(),t.append('<option value="">--------------------------------</option>'),$.each(n,function(o,a){t.append($("<option>",{value:a.district_id,text:a.district_name}))})},failure:function(n){alert(n.responseText)},error:function(n){alert(n.responseText)}})})}function T(e){return new Promise((r,n)=>{$.ajax({type:"GET",url:`/getSchoolByDistrictId/${e}`,data:{},success:function(t){console.log(t);var o=$("#school-select");o.empty(),o.append('<option value="">--------------------------------</option>'),$.each(t,function(a,l){o.append($("<option>",{value:l.school_id,text:l.school_name}))})},failure:function(t){alert(t.responseText)},error:function(t){alert(t.responseText)}})})}});
